/*!
 * gamepad.js v0.0.4-alpha 2014-06-01T00:44:21
 * https://github.com/neogeek/gamepad.js
 * 
 * Copyright (c) 2014 Scott Doxey
 * Released under the MIT license.
 */
!function(){"use strict";function a(a){return"[object Array]"===Object.prototype.toString.call(a)?!0:!1}function b(b,c){var d;return Object.keys(c).forEach(function(e){c[e]===b?d=e:a(c[e])&&-1!==c[e].indexOf(b)&&(d=e)}),d}function c(){this._events={gamepad:[],keyboard:{}},this._keyMapping={gamepad:{button_1:0,button_2:1,button_3:2,button_4:3,shoulder_top_left:4,shoulder_top_right:5,shoulder_bottom_left:6,shoulder_bottom_right:7,select:8,start:9,stick_button_left:10,stick_button_right:11,d_pad_up:12,d_pad_down:13,d_pad_left:14,d_pad_right:15,vendor:16},keyboard:{button_1:32,start:27,d_pad_up:[38,87],d_pad_down:[40,83],d_pad_left:[37,65],d_pad_right:[39,68]}},this._listeners=[],this._requestAnimation=d(this._loop.bind(this)),document.addEventListener("keydown",this._handleKeyboardEventListener.bind(this)),document.addEventListener("keyup",this._handleKeyboardEventListener.bind(this))}var d,e;["webkit","moz"].forEach(function(a){d=d||window.requestAnimationFrame||window[a+"RequestAnimationFrame"]||null,e=e||window.cancelAnimationFrame||window[a+"CancelAnimationFrame"]||null}),c.prototype._handleGamepadEventListener=function(a){var c=this;a.connected&&(c._events.gamepad[a.index]||(c._events.gamepad[a.index]={}),a.buttons.forEach(function(d,e){var f=b(e,c._keyMapping.gamepad);f&&(d.pressed&&!c._events.gamepad[a.index][f]?c._events.gamepad[a.index][f]={pressed:!0,hold:!1,released:!1,player:a.index}:!d.pressed&&c._events.gamepad[a.index][f]&&(c._events.gamepad[a.index][f].released=!0,c._events.gamepad[a.index][f].hold=!1))}))},c.prototype._handleKeyboardEventListener=function(a){var c=b(a.keyCode,this._keyMapping.keyboard);c&&("keydown"!==a.type||this._events.keyboard[c]?"keyup"===a.type&&this._events.keyboard[c]&&(this._events.keyboard[c].released=!0,this._events.keyboard[c].hold=!1):this._events.keyboard[c]={pressed:!0,hold:!1,released:!1})},c.prototype._handleEvent=function(a,b,c){b[a].pressed?(this.trigger("press",a,c),b[a].pressed=!1,b[a].hold=!0):b[a].hold?this.trigger("hold",a,c):b[a].released&&(this.trigger("release",a,c),delete b[a])},c.prototype._loop=function(){var a=this;Array.prototype.slice.call(window.navigator.getGamepads()).forEach(a._handleGamepadEventListener.bind(a)),Object.keys(a._events.keyboard).forEach(function(b){a._handleEvent(b,a._events.keyboard,"keyboard")}),a._events.gamepad.forEach(function(b,c){Object.keys(b).forEach(function(d){a._handleEvent(d,b,c)})}),a._requestAnimation=d(a._loop.bind(a))},c.prototype.on=function(a,b,c,d){this._listeners.push({type:a,button:b,callback:c,options:d})},c.prototype.trigger=function(a,b,c){this._listeners.forEach(function(d){d.type===a&&d.button===b&&d.callback({type:d.type,button:d.button,player:c,event:d})})},"function"==typeof define&&void 0!==define.amd?define([],c):"object"==typeof module&&void 0!==module.exports?module.exports=c:window.Gamepad=c}();