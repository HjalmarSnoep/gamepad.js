/*!
 * gamepad.js v0.0.2-alpha
 * https://github.com/neogeek/gamepad.js
 *
 * Copyright (c) 2014 Scott Doxey
 * Released under the MIT license
 */

(function(){"use strict";var t={standard:{button_1:0,button_2:1,button_3:2,button_4:3,shoulder_top_left:4,shoulder_top_right:5,shoulder_bottom_left:6,shoulder_bottom_right:7,select:8,start:9,stick_button_left:10,stick_button_right:11,d_pad_up:12,d_pad_down:13,d_pad_left:14,d_pad_right:15,vendor:16}};function o(){this.listeners=[];this.activeButtons=[];this.activeControllers=[];window.requestAnimationFrame(this._loop.bind(this))}o.prototype._handleController=function(o,e){var n=t[o.mapping];this.listeners.forEach(function(t){if(o.buttons[n[t.button]].pressed&&typeof t.callback==="function"){if(!this.activeButtons[e][t.button]){this.activeButtons[e][t.button]={}}if(!this.activeButtons[e][t.button].delay&&t.options.delay){this.activeButtons[e][t.button].delay=t.options.delay}else if(this.activeButtons[e][t.button].delay){this.activeButtons[e][t.button].delay=this.activeButtons[e][t.button].delay-1;return false}if(t.options.once&&this.activeButtons[e][t.button].triggered){return false}this.activeButtons[e][t.button].triggered=true;t.callback({button:t.button,value:o.buttons[n[t.button]].value,player:e})}else if(this.activeButtons[e][t.button]){this.activeButtons[e][t.button]=null}}.bind(this))};o.prototype._loop=function(){var t=window.navigator.getGamepads(),o,e;this.activeControllers=[];for(o=0,e=t.length;o<e;o=o+1){if(t[o]&&t[o].connected){if(!this.activeButtons[o]){this.activeButtons[o]={}}this.activeControllers.push(t[o])}}this.activeControllers.forEach(this._handleController.bind(this));window.requestAnimationFrame(this._loop.bind(this))};o.prototype.on=function(t,o,e){if(typeof o==="function"&&e===undefined){e=o;o={}}this.listeners.push({button:t,options:o,callback:e})};o.prototype.off=function(t){this.listeners.forEach(function(o){if(o.button===t){this.listeners.splice(this.listeners.indexOf(o),1)}})};if(typeof define==="function"&&define.amd!==undefined){define([],o)}else if(typeof module==="object"&&module.exports!==undefined){module.exports=o}else{window.Gamepad=o}})();
